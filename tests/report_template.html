<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EquiML Evaluation Report</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body { padding-top: 20px; }
        .card { margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="jumbotron text-center">
            <h1 class="display-4">EquiML Evaluation Report</h1>
            <p class="lead">Generated on: {{ generation_date }}</p>
        </div>

        <div class="card">
            <div class="card-header">
                <h2>Executive Summary</h2>
            </div>
            <div class="card-body">
                <p>This report provides a comprehensive evaluation of the machine learning model, focusing on performance, fairness, and robustness.</p>
                <h4>Key Findings:</h4>
                <ul>
                    <li>Accuracy: <span class="badge badge-primary">{{ metrics.accuracy | round(3) }}</span></li>
                    <li>Demographic Parity Difference: <span class="badge badge-warning">{{ metrics.demographic_parity_difference | round(3) }}</span></li>
                    <li>Noise Sensitivity: <span class="badge badge-info">{{ metrics.robustness.noise_sensitivity | round(3) }}</span></li>
                </ul>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2>Recommendations</h2>
            </div>
            <div class="card-body">
                {% if metrics.demographic_parity_difference > 0.1 %}
                <div class="alert alert-warning" role="alert">
                    The model shows a significant demographic parity difference. Consider using a fairness mitigation technique like reweighing or GridSearch.
                </div>
                {% else %}
                <div class="alert alert-success" role="alert">
                    The model appears to be fair with respect to demographic parity.
                </div>
                {% endif %}
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2>Detailed Metrics</h2>
            </div>
            <div class="card-body">
                <h3>Performance</h3>
                <table class="table table-bordered">
                    <tbody>
                        <tr><th>Accuracy</th><td>{{ metrics.accuracy | round(3) }}</td></tr>
                        <tr><th>F1-Score</th><td>{{ metrics.f1_score | round(3) }}</td></tr>
                        {% if 'roc_auc' in metrics %}
                        <tr><th>ROC AUC</th><td>{{ metrics.roc_auc | round(3) }}</td></tr>
                        {% endif %}
                    </tbody>
                </table>

                <h3>Fairness</h3>
                <table class="table table-bordered">
                    <tbody>
                        <tr><th>Demographic Parity Difference</th><td>{{ metrics.demographic_parity_difference | round(3) }}</td></tr>
                        <tr><th>Equalized Odds Difference</th><td>{{ metrics.equalized_odds_difference | round(3) }}</td></tr>
                    </tbody>
                </table>

                <h3>Robustness</h3>
                <table class="table table-bordered">
                    <tbody>
                        <tr><th>Cross-Validation Mean Score</th><td>{{ metrics.robustness.cv_mean | round(3) }}</td></tr>
                        <tr><th>Noise Sensitivity</th><td>{{ metrics.robustness.noise_sensitivity | round(3) }}</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</body>
</html>
